<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="js/sockjs.js"></script>
    <script type="text/javascript" src="js/stomp.min.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
</head>
<body>
    <h5>cells</h5>
    <div id="cells">

    </div>
    <div id="chats">

    </div>
    <div>
        <p>my cell:</p>
        x: <input type="text" name="x" id="x"><br>
        y: <input type="text" name="y" id="y"><br>
        z: <input type="text" name="z" id="z"><br>
        <button onclick="send()">change position</button>
    </div>
<script>
    var rootPath = "http://localhost:8080";
    var socket = null;
    var stompClient = null;
    function connect() {
        socket = new SockJS(rootPath + '/ws');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            // 订阅 /topic/to-all 实现公告
            stompClient.subscribe('/topic/positionToAll',
                function (dd) {
                    console.log("received:" + dd);
                    $("#cells").append("<p>" + JSON.parse(dd.body) + "</p>");
                });
            // 订阅 /user/userId/to-one 实现点对点
            stompClient.subscribe('/user/' + localStorage.getItem("user_id") + '/toOne',
                function (dd) {
                    //showMsg(JSON.parse(dd.body));
                });
        });
    }
    connect();
    function send() {
        var webMsg = {
            'x': parseInt($("#x").val()),
            'y': parseInt($("#y").val()),
            'z': parseInt($("#z").val()),
            'objectId': parseInt(localStorage.getItem("cellId"))
        };
        stompClient.send("/app/updatePosition",{},
            JSON.stringify(webMsg));
    }


</script>
</body>
</html>